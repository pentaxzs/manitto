<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë§ˆë‹ˆë˜ í˜ì–´ ë§¤ì¹­</title>
  <!-- ëª¨ë°”ì¼ ë°˜ì‘í˜• -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<!-- âœ… ëª¨ë°”ì¼ í•˜ë‹¨ ë°°ë„ˆ(50px) ê³µê°„ í™•ë³´: pb-[70px] -->
<body class="min-h-screen bg-slate-900 flex justify-center px-3 py-4 md:px-4 md:py-8 pb-[70px]">

  <div class="w-full max-w-3xl bg-slate-800 rounded-2xl shadow-2xl p-4 md:p-8 text-slate-100">
    <header class="mb-6">
      <h1 class="text-xl md:text-3xl font-bold tracking-tight mb-2">
        ë§ˆë‹ˆë˜ í˜ì–´ ë§¤ì¹­ê¸° ğŸ
      </h1>
      <p class="text-xs md:text-base text-slate-300 leading-relaxed">
        ì‚¬ëŒ ì´ë¦„ì„ ì‰¼í‘œ( , )ë¡œ êµ¬ë¶„í•´ì„œ ìµœëŒ€ 50ëª…ê¹Œì§€ ì…ë ¥í•œ ë’¤, ëœë¤ ë§¤ì¹­ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´
        <span class="font-semibold text-indigo-300">2~3ì¸ ê·¸ë£¹ í˜ì–´</span> ë˜ëŠ”
        <span class="font-semibold text-emerald-300">ìˆœí™˜ ë§¤ì¹­</span> ì¤‘ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë§ˆë‹ˆë˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </header>

    <!-- ì…ë ¥ ì˜ì—­ -->
    <section class="mb-6">
      <div class="flex items-center justify-between gap-2 mb-2">
        <label for="namesInput" class="text-sm font-medium text-slate-200">
          ì´ë¦„ ëª©ë¡
        </label>
        <span id="countBadge" class="text-[11px] rounded-full px-3 py-1 bg-slate-700 text-slate-200 whitespace-nowrap">
          0 / 50ëª…
        </span>
      </div>
      <textarea
        id="namesInput"
        class="w-full h-32 md:h-36 resize-none rounded-xl border border-slate-600 bg-slate-900/70 px-3 py-2 text-base md:text-base focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 placeholder-slate-500"
        placeholder="ì˜ˆì‹œ&#10;ê¹€ë¯¼ìˆ˜, ì´ì˜í¬, ë°•ì² ìˆ˜, ì •í•´ì§„"
      ></textarea>
      <p class="mt-2 text-[11px] md:text-xs text-slate-400 leading-relaxed">
        Â· ì‰¼í‘œ( , ) ê¸°ì¤€ìœ¼ë¡œ ì´ë¦„ì„ êµ¬ë¶„í•´ ì£¼ì„¸ìš”. ì˜ˆ) ê¹€ë¯¼ìˆ˜, ì´ì˜í¬, ë°•ì² ìˆ˜<br />
        Â· ê³µë°±ì€ ìë™ìœ¼ë¡œ ì œê±°ë˜ê³ , ë¹„ì–´ ìˆëŠ” ì´ë¦„ì€ ë¬´ì‹œë©ë‹ˆë‹¤.
      </p>
    </section>

    <!-- ë§¤ì¹­ ë°©ì‹ ì„ íƒ -->
    <section class="mb-4 text-xs md:text-sm">
      <p class="mb-1 text-slate-300 font-medium">ë§¤ì¹­ ë°©ì‹</p>
      <div class="flex flex-col sm:flex-row gap-2">
        <label class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900/60 border border-slate-600 cursor-pointer">
          <input
            type="radio"
            name="matchType"
            value="group"
            class="accent-indigo-500"
            checked
          />
          <span class="flex flex-col">
            <span class="font-semibold text-slate-100">ê·¸ë£¹ í˜ì–´ ë§¤ì¹­</span>
            <span class="text-[11px] text-slate-400">
              2ëª…ì”©(ë§ˆì§€ë§‰ì€ í•„ìš” ì‹œ 3ëª…) ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ê·¸ë£¹ ì•ˆì—ì„œ ì„œë¡œ ì„ ë¬¼ êµí™˜
            </span>
          </span>
        </label>
        <label class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900/60 border border-slate-600 cursor-pointer">
          <input
            type="radio"
            name="matchType"
            value="cycle"
            class="accent-emerald-500"
          />
          <span class="flex flex-col">
            <span class="font-semibold text-slate-100">ëœë¤ ìˆœí™˜ ë§¤ì¹­</span>
            <span class="text-[11px] text-slate-400">
              Aâ†’Bâ†’Câ†’â€¦â†’A ì²˜ëŸ¼ í•œ ì¤„ë¡œ ì´ì–´ì§€ëŠ” ì‹œí¬ë¦¿ ì‚°íƒ€ ìˆœí™˜ êµ¬ì¡°
            </span>
          </span>
        </label>
      </div>
    </section>

    <!-- ê²½ê³ /ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div id="errorBox" class="hidden mb-4 rounded-xl border border-red-400 bg-red-500/10 px-4 py-3 text-xs md:text-sm text-red-200">
    </div>

    <!-- ë²„íŠ¼ -->
    <div class="flex flex-col md:flex-row gap-2 md:gap-4 mb-4">
      <button
        id="shuffleButton"
        class="w-full md:flex-1 inline-flex items-center justify-center rounded-xl bg-indigo-500 hover:bg-indigo-400 active:bg-indigo-600 px-4 py-2 text-sm md:text-base font-semibold transition disabled:opacity-60 disabled:cursor-not-allowed"
      >
        ğŸ”€ ëœë¤ ë§¤ì¹­ ì‹œì‘
      </button>
      <button
        id="clearButton"
        class="w-full md:w-28 inline-flex items-center justify-center rounded-xl border border-slate-600 bg-slate-800 hover:bg-slate-700 active:bg-slate-900 px-4 py-2 text-sm md:text-base font-medium text-slate-200 transition"
      >
        ì´ˆê¸°í™”
      </button>
      <button
        id="downloadCsvButton"
        class="w-full md:w-40 inline-flex items-center justify-center rounded-xl border border-emerald-500/60 bg-emerald-600/80 hover:bg-emerald-500 active:bg-emerald-700 px-4 py-2 text-sm md:text-base font-semibold text-slate-50 transition disabled:opacity-50 disabled:cursor-not-allowed"
        disabled
      >
        ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ
      </button>
    </div>

    <!-- ë³´ê¸° ëª¨ë“œ í† ê¸€ -->
    <div class="mb-4 flex flex-wrap items-center gap-2 text-xs md:text-sm">
      <span class="text-slate-300">ë³´ê¸° ëª¨ë“œ:</span>
      <button
        id="viewAllButton"
        class="px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-indigo-500 text-white border border-indigo-400"
        data-mode="all"
      >
        ì „ì²´ë³´ê¸°
      </button>
      <button
        id="viewSecretButton"
        class="px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-slate-700 text-slate-100 border border-slate-500"
        data-mode="secret"
      >
        ë§ˆë‹ˆë˜ ë¹„ë°€ë³´ê¸°
      </button>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <section>
      <h2 class="text-base md:text-lg font-semibold mb-3 text-slate-100">
        ë§¤ì¹­ ê²°ê³¼
      </h2>
      <div id="resultContainer" class="space-y-3 text-sm md:text-base text-slate-200">
        <p class="text-slate-400 text-sm">
          ì•„ì§ ë§¤ì¹­ì„ ì‹œì‘í•˜ì§€ ì•Šì•˜ì–´ìš”. ì°¸ê°€ì ì´ë¦„ì„ ì…ë ¥í•˜ê³  <span class="font-semibold text-indigo-300">[ëœë¤ ë§¤ì¹­ ì‹œì‘]</span> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </p>
      </div>
    </section>
  </div>

    <!-- âœ… PC/ëª¨ë°”ì¼ ëª¨ë‘ í•˜ë‹¨ ê³ ì • ë°°ë„ˆ -->
    <div class="fixed bottom-0 left-0 right-0 z-50">
      <div class="mx-auto w-[320px] h-[50px]">
        <ins class="kakao_ad_area" style="display:none;"
          data-ad-unit="DAN-A4CEKaITxzS7T4aW"
          data-ad-width="320"
          data-ad-height="50"></ins>
      </div>
    </div>

  </div>

  <!-- âœ… ì¹´ì¹´ì˜¤ ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸: body í•˜ë‹¨ì— 1íšŒë§Œ -->
  <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>

  <script>
    const namesInput = document.getElementById('namesInput');
    const shuffleButton = document.getElementById('shuffleButton');
    const clearButton = document.getElementById('clearButton');
    const downloadCsvButton = document.getElementById('downloadCsvButton');
    const resultContainer = document.getElementById('resultContainer');
    const errorBox = document.getElementById('errorBox');
    const countBadge = document.getElementById('countBadge');
    const viewAllButton = document.getElementById('viewAllButton');
    const viewSecretButton = document.getElementById('viewSecretButton');

    let currentPairs = [];
    let currentNames = [];
    let currentViewMode = 'all';   // 'all' | 'secret'
    let currentMatchType = 'group'; // 'group' | 'cycle'

    function getCleanNames() {
      return namesInput.value
        .split(',')
        .map((name) => name.trim())
        .filter((name) => name.length > 0);
    }

    function updateCount() {
      const names = getCleanNames();
      countBadge.textContent = names.length + ' / 50ëª…';
    }

    function showError(message) {
      errorBox.textContent = message;
      errorBox.classList.remove('hidden');
    }

    function clearError() {
      errorBox.textContent = '';
      errorBox.classList.add('hidden');
    }

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // 2~3ì¸ ê·¸ë£¹ í˜ì–´ ë§¤ì¹­
    function makeGroupPairs(names) {
      const shuffled = shuffleArray(names);
      const pairs = [];

      for (let i = 0; i < shuffled.length; i += 2) {
        // ë‚¨ì€ ì¸ì›ì´ 3ëª…ì¼ ë•ŒëŠ” 3ì¸ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê¸°
        if (shuffled.length - i === 3) {
          pairs.push(shuffled.slice(i, i + 3));
          break;
        } else {
          pairs.push(shuffled.slice(i, i + 2));
        }
      }
      return pairs;
    }

    // ì „ì²´ë¥¼ í•œ ì¤„ë¡œ ì´ì–´ì§€ëŠ” ìˆœí™˜ ë§¤ì¹­ (Aâ†’Bâ†’Câ†’â€¦â†’A)
    function makeRandomCycle(names) {
      const shuffled = shuffleArray(names);
      return [shuffled]; // í•˜ë‚˜ì˜ í° ê·¸ë£¹ìœ¼ë¡œ ë‹¤ë£¬ë‹¤
    }

    function renderAllView() {
      if (!currentPairs.length) {
        resultContainer.innerHTML =
          '<p class="text-slate-400 text-sm">ì•„ì§ ë§¤ì¹­ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € <span class="font-semibold text-indigo-300">[ëœë¤ ë§¤ì¹­ ì‹œì‘]</span> ë²„íŠ¼ìœ¼ë¡œ ë§¤ì¹­ì„ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.</p>';
        return;
      }

      resultContainer.innerHTML = '';

      currentPairs.forEach((group, index) => {
        const card = document.createElement('div');
        card.className =
          'rounded-xl border border-slate-700 bg-slate-900/70 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2';

        const left = document.createElement('div');

        const arrow = currentMatchType === 'cycle' ? '  â†’  ' : '  â†”  ';
        let content = group.join(arrow);
        if (currentMatchType === 'cycle' && group.length > 1) {
          // ìˆœí™˜ì„ì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ë§ˆì§€ë§‰ì— ë‹¤ì‹œ ì²« ì‚¬ëŒ í‘œì‹œ
          content = group.join('  â†’  ') + '  â†’  ' + group[0];
        }

        const label =
          currentMatchType === 'cycle'
            ? (group.length === currentNames.length ? 'ì „ì²´ ìˆœí™˜' : 'ìˆœí™˜ ê·¸ë£¹')
            : (group.length === 2 ? 'PAIR' : '3ì¸ ê·¸ë£¹');

        left.innerHTML = `
          <p class="text-[11px] text-slate-400 mb-1">ê·¸ë£¹ ${index + 1}</p>
          <p class="font-semibold break-words">
            ${content}
          </p>
        `;

        const tag = document.createElement('span');
        tag.className =
          'self-start sm:self-auto text-[10px] uppercase tracking-wide px-2 py-1 rounded-full border border-indigo-500 text-indigo-200 bg-indigo-500/10';
        tag.textContent = label;

        card.appendChild(left);
        card.appendChild(tag);
        resultContainer.appendChild(card);
      });
    }

    function buildSecretMap() {
      const map = {};
      currentPairs.forEach((group) => {
        group.forEach((name, idx) => {
          const target = group[(idx + 1) % group.length]; // ì›í˜• êµ¬ì¡°
          map[name] = target;
        });
      });
      return map;
    }

    function renderSecretView() {
      if (!currentPairs.length) {
        resultContainer.innerHTML =
          '<p class="text-slate-400 text-sm">ì•„ì§ ë§¤ì¹­ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € <span class="font-semibold text-indigo-300">[ëœë¤ ë§¤ì¹­ ì‹œì‘]</span> ë²„íŠ¼ìœ¼ë¡œ ë§¤ì¹­ì„ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.</p>';
        return;
      }

      const secretMap = buildSecretMap();

      const wrapper = document.createElement('div');
      wrapper.className = 'space-y-3';

      const desc = document.createElement('p');
      desc.className = 'text-[11px] md:text-sm text-slate-300 leading-relaxed';
      desc.innerHTML =
        'ì•„ë˜ì—ì„œ ìì‹ ì˜ ì´ë¦„ì„ ì„ íƒí•˜ë©´, <span class="font-semibold text-emerald-300">ë‚´ ë§ˆë‹ˆë˜ê°€ ëˆ„êµ¬ì¸ì§€</span>ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê° ê·¸ë£¹ ì•ˆì—ì„œ ì›í˜•ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.)';
      wrapper.appendChild(desc);

      const controlRow = document.createElement('div');
      controlRow.className = 'flex flex-col md:flex-row gap-2 md:items-center';

      const select = document.createElement('select');
      select.id = 'secretSelect';
      select.className =
        'flex-1 rounded-lg border border-slate-600 bg-slate-900/80 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500';

      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”';
      select.appendChild(defaultOption);

      const sortedNames = [...currentNames].sort((a, b) =>
        a.localeCompare(b, 'ko')
      );
      sortedNames.forEach((name) => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });

      const btn = document.createElement('button');
      btn.textContent = 'ë‚´ ë§ˆë‹ˆë˜ ë³´ê¸°';
      btn.className =
        'md:w-32 inline-flex items-center justify-center rounded-lg bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 px-3 py-2 text-xs md:text-sm font-semibold text-slate-50 transition';

      controlRow.appendChild(select);
      controlRow.appendChild(btn);
      wrapper.appendChild(controlRow);

      const result = document.createElement('div');
      result.id = 'secretResult';
      result.className =
        'mt-2 text-sm md:text-base text-slate-200 bg-slate-900/60 border border-slate-700 rounded-xl px-4 py-3';
      result.textContent = 'ì´ë¦„ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ˆë‹ˆë˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
      wrapper.appendChild(result);

      resultContainer.innerHTML = '';
      resultContainer.appendChild(wrapper);

      btn.addEventListener('click', () => {
        const selected = select.value;
        if (!selected) {
          result.textContent = 'ë¨¼ì € ìœ„ì—ì„œ ìì‹ ì˜ ì´ë¦„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
          return;
        }
        const target = secretMap[selected];
        if (!target) {
          result.textContent = 'ì„ íƒí•œ ì´ë¦„ì— ëŒ€í•œ ë§ˆë‹ˆë˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }
        result.innerHTML = `
          <span class="font-semibold text-emerald-300">${selected}</span>ë‹˜ì˜ ë§ˆë‹ˆë˜ëŠ”
          <span class="font-semibold text-amber-300">${target}</span> ì…ë‹ˆë‹¤. ğŸ¤«
        `;
      });
    }

    function renderView() {
      if (currentViewMode === 'all') {
        renderAllView();
      } else {
        renderSecretView();
      }
    }

    function setViewMode(mode) {
      currentViewMode = mode;
      if (mode === 'all') {
        viewAllButton.className =
          'px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-indigo-500 text-white border border-indigo-400';
        viewSecretButton.className =
          'px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-slate-700 text-slate-100 border border-slate-500';
      } else {
        viewSecretButton.className =
          'px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-indigo-500 text-white border border-indigo-400';
        viewAllButton.className =
          'px-3 py-1 rounded-full text-[11px] md:text-xs font-medium bg-slate-700 text-slate-100 border border-slate-500';
      }
      renderView();
    }

    function updateDownloadButtonState() {
      downloadCsvButton.disabled = currentPairs.length === 0;
    }

    function downloadCSV() {
      if (!currentPairs.length) return;

      const rows = [['Person', 'Manitto', 'Group']];
      currentPairs.forEach((group, groupIdx) => {
        group.forEach((name, i) => {
          const target = group[(i + 1) % group.length];
          rows.push([name, target, 'Group ' + (groupIdx + 1)]);
        });
      });

      const csvContent = rows
        .map((row) =>
          row
            .map((field) => {
              const value = String(field).replace(/"/g, '""');
              return `"${value}"`;
            })
            .join(',')
        )
        .join('\r\n');

      const blob = new Blob([csvContent], {
        type: 'text/csv;charset=utf-8;',
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'manitto_pairs.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    shuffleButton.addEventListener('click', () => {
      clearError();
      const names = getCleanNames();

      if (names.length < 2) {
        showError('ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•´ì•¼ ë§ˆë‹ˆë˜ ë§¤ì¹­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        resultContainer.innerHTML =
          '<p class="text-slate-400 text-sm">ì°¸ê°€ìë¥¼ ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
        currentPairs = [];
        updateDownloadButtonState();
        return;
      }

      if (names.length > 50) {
        showError('ìµœëŒ€ 50ëª…ê¹Œì§€ë§Œ ë§¤ì¹­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¸ì›ì„ ì¤„ì—¬ì£¼ì„¸ìš”.');
        currentPairs = [];
        updateDownloadButtonState();
        return;
      }

      const matchTypeInput = document.querySelector('input[name="matchType"]:checked');
      const matchType = matchTypeInput ? matchTypeInput.value : 'group';
      currentMatchType = matchType;

      currentNames = names;
      if (matchType === 'cycle') {
        currentPairs = makeRandomCycle(names);
      } else {
        currentPairs = makeGroupPairs(names);
      }

      updateDownloadButtonState();
      renderView();
    });

    clearButton.addEventListener('click', () => {
      namesInput.value = '';
      currentPairs = [];
      currentNames = [];
      updateCount();
      clearError();
      updateDownloadButtonState();
      resultContainer.innerHTML =
        '<p class="text-slate-400 text-sm">ì•„ì§ ë§¤ì¹­ì„ ì‹œì‘í•˜ì§€ ì•Šì•˜ì–´ìš”. ì°¸ê°€ì ì´ë¦„ì„ ì…ë ¥í•˜ê³  <span class="font-semibold text-indigo-300">[ëœë¤ ë§¤ì¹­ ì‹œì‘]</span> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>';
    });

    namesInput.addEventListener('input', updateCount);

    viewAllButton.addEventListener('click', () => setViewMode('all'));
    viewSecretButton.addEventListener('click', () => setViewMode('secret'));

    downloadCsvButton.addEventListener('click', downloadCSV);

    // ì´ˆê¸° ì„¸íŒ…
    updateCount();
    setViewMode('all');
    updateDownloadButtonState();
  </script>
</body>
</html>
